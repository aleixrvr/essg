---
title: "ALIF EXPLORATION"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(echo = TRUE, root.dir=normalizePath('../../'))
```

```{r warning=FALSE, include=FALSE}
library(data.table)
library(magrittr)
library(kableExtra)
library(yaml)

source('code/alif/alif-utils.R')
source('code/propensity-utils.R')

sel_data <- get_data()
```

```{r echo=FALSE, warning=FALSE, results="asis"}
explore_vars(sel_data, outcome_name='alif')
```


## Propensity Scores Overlapping
```{r echo=FALSE, warning=FALSE}
run_propensity(
  sel_data, 
  outcome_name='alif', 
  tuneLength = 10, 
  models = c('lm', 'boosting', 'elastic')
) -> best_model
```

#### Model Stats

- Model Type: `r best_model$sel_model`
- Accuracy: `r best_model$accuracy`
- Params: `r as.yaml(best_model$params)`
 

```{r echo=FALSE}
print(best_model$plot)
```

```{r warning=FALSE, echo=FALSE}
# best_model$clean_data %>% 
#   colnames(.) %!in% c('alif', 'propensity') ->
#   matching_vars
# 
# for(matching_var in matching_vars){
#   if( class(best_model$clean_data[[matching_var]]) == 'numeric' ){
#     best_model$clean_data %>% 
#       ggplot(aes_string('propensity', matching_var, color='alif')) +
#       geom_point(alpha = 0.2, size = 1.3) +
#       geom_smooth(method = "loess", se = FALSE) +
#       xlab("Propensity score") -> 
#       res_plot
#   }else{
#     best_model$clean_data %>% 
#       ggplot(aes_string(matching_var, 'propensity', color='alif')) +
#       geom_boxplot() +
#       xlab("Propensity score") -> 
#       res_plot
#   }
#   print(res_plot)
# }

```

