---
title: "LIV Iliac/L5"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE, eval=TRUE}
knitr::opts_knit$set(
  root.dir=normalizePath('../')
)

knitr::opts_chunk$set(
  echo = FALSE, 
  warning=FALSE, 
  comment="",
  message=FALSE
)
```

```{r include=FALSE}
library(data.table)
library(magrittr)
library(yaml)
library(flextable)

source('liv_l4_l5_review/patient_selection_review.R')
source('liv_l4_l5_review/utils.R')
```

```{r, message=FALSE, warning=FALSE}
xls_path <- '../../data/June 2023 All (2).xlsx'
analysis_vars <- read_yaml('descriptive.yml')
data_ <- get_data(xls_path)
```


```{r echo=TRUE}
data_ %>% 
  .[followup_2y ==TRUE] %>% 
  .[Study=='Op'] %>% 
  .[Site != 'ANK Op'] %>% 
  .[Age < 100] %>% 
  .[`Vital status` == 'Alive'] ->
  data_
```

Initial Patients: `r data_[, .N]`

```{r echo=TRUE}
data_ %<>% 
  .[`Posterior Instrumented Fusion` == 'Yes'] %>% 
  .[`Number of Posterior Instrumented Levels` > 3]
```
With Posterior Instrumented Fusion & Number of Posterior Instrumented Levels > 3: `r data_[, .N]`




```{r, comment="", include=TRUE}
data_[, `Posterior Instrumented Fusion: Upper / Lower Levels`] %>% 
  sapply(. %>% strsplit('-') %>% .[[1]] %>% .[2]) ->
  post_intr_fusion

data_[post_intr_fusion == 'Iliac', type := 'Iliac']
data_[post_intr_fusion == 'L5', type := 'L5']
data_[post_intr_fusion == 'L4', type := 'L4']
data_ %<>% .[!is.na(type)] 

data_[, .N, type]
```

<!-- With 5Y FU -->
<!-- ```{r, comment="", include=TRUE} -->
<!-- data_ %<>% .[followup_5y==TRUE] -->
<!-- data_[, .N, type] -->
<!-- ``` -->


Patients who end up intrumented until pelvis
```{r, comment="", include=TRUE, echo=TRUE, warning=FALSE, message=FALSE}
revision <- read_excel(xls_path, sheet="Revision surgery") %>% 
  as.data.table() 

revision[, `Posterior Instrumented Fusion: Upper / Lower Levels`] %>% 
  sapply(. %>% strsplit('-') %>% .[[1]] %>% .[2]) ->
  post_intr_fusion

reint_iliac <- revision[post_intr_fusion=='Iliac', `Code of the patient`]

data_[`Code of the patient` %in% reint_iliac, `Code of the patient` %>% uniqueN, type]
```

UIV frequencies
```{r, comment="", include=TRUE}
data_[, `Posterior Instrumented Fusion: Upper / Lower Levels`] %>% 
  sapply(. %>% strsplit('-') %>% .[[1]] %>% .[1]) -> 
  post_intr_fusion_upper 
data.table(uiv = post_intr_fusion_upper) %>% 
  .[, .N, uiv] %>% 
  setorder(uiv) %>% 
  print
```

```{r}
treatment_ <- 'type'
treatment_vals <- c('Iliac', 'L5', 'L4')
treatment_n <- len(treatment_vals)
```

```{r}
data_treats <- list()
for(treatment_pos in 1:treatment_n){
  data_treats[[treatment_pos]] <- data_[get(treatment_) == treatment_vals[treatment_pos]]
}
```

```{r, comment="", include=TRUE}
data_[, .N, c("Non_instrumented_segments", treatment_)] %>% 
  setorder(type, Non_instrumented_segments) %>% na.omit %>% print
```


### P-valor ASA 1 Iliac vs L5 
```{r, comment="", include=TRUE}
var_ <- "ASA classification"
data_[, .(
  treatment=get(treatment_), variable=get(var_))] ->
  data__

data__[, variable := ifelse(as.character(variable) == 1, 1, 2)]
res <- data__[, .(asa_1 = sum(variable == 1, na.rm = TRUE), .N), treatment] %>% 
  .[!is.na(treatment)]

print(res)
```


```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 2
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$asa_1,
    res[treatment==treatment_vals[n2]]$asa_1
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$asa_1,
    res[treatment==treatment_vals[n2]]$asa_1
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 2
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$asa_1,
    res[treatment==treatment_vals[n2]]$asa_1
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

### P-valor Prior Spine Surgery Yes Iliac vs L5
```{r, comment="", include=TRUE}
var_ <- "Prior Spine Surgery"
data_[, .(
  treatment=get(treatment_), variable=get(var_))] ->
  data__

res <- data__[, .(prior_yes = sum(variable == 'Yes', na.rm=TRUE), .N), treatment] %>% 
  .[!is.na(treatment)]

print(res)
```

  
```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 2
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 2
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```


### 3CO

```{r, comment="", include=TRUE}
var_ <- "3CO"
data_[, .(
  treatment=get(treatment_), variable=get(var_))] ->
  da

res <- data__[, .(prior_yes = sum(variable == 'Yes', na.rm = TRUE), .N), treatment] %>%
  .[!is.na(treatment)]

print(res)
```


```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 2
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 1
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```

```{r, comment="", include=TRUE}
n1 <- 2
n2 <- 3
print("P-values Treatment {treatment_vals[n1]} vs Treatment {treatment_vals[n2]}" %>% f)
prop.test(
  c(
    res[treatment==treatment_vals[n1]]$prior_yes,
    res[treatment==treatment_vals[n2]]$prior_yes
  ),
  c(
    res[treatment==treatment_vals[n1]]$N,
    res[treatment==treatment_vals[n2]]$N
  ))$p.val %>% round(4)
```



### Demographics
```{r, comment="", echo=FALSE, comment="", include=TRUE, warning=FALSE}
results <- NULL
for(var_ in analysis_vars$demographics ){
  result <- calc_table(data_, var_, treatment_n, data_treats, treatment_vals, treatment_)
  if(is.null(results)){
    results <- result
  }else{
    results <- rbind(results, result)
  }
}

results %>% flextable %>% autofit() %>% fit_to_width(7.5)
```


### Radiology
```{r echo=FALSE, comment="", include=TRUE}
results <- NULL
p_vals <- list()
p_vals_treats <- list()
for(treatment_pos in 1:treatment_n){
    p_vals_treats[[treatment_vals[treatment_pos]]] <- list()
}

for(var_ in analysis_vars$radiology ){
  var_6w <- "6W. {var_}" %>% f
  var_6m <- "6M. {var_}" %>% f
  var_1y <- "1Y. {var_}" %>% f
  var_2y <- "2Y. {var_}" %>% f
  var_5y <- "5Y. {var_}" %>% f
  vars_years <- c(var_, var_6w, var_6m, var_1y, var_2y, var_5y)
  for(var_y in vars_years){
    result <- calc_table(data_, var_y, treatment_n, data_treats, treatment_vals, treatment_)
    if(is.null(results)){
      results <- result
    }else{
      results <- rbind(results, result)
    }
  }
    
  p_vals[[var_]] <- list()
  val_ <- data_[[var_]]
  val_6w <- data_[[var_6w]]
  val_2y <- data_[[var_2y]]
  val_5y <- data_[[var_5y]]
  p_vals[[var_]]['Preop vs 6w'] <- t.test(val_6w , val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 2y'] <- t.test(val_2y, val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 5y'] <- t.test(val_5y, val_)$p.val %>% round(4)
  p_vals[[var_]]['6w vs 2y'] <- t.test(val_2y, val_6w)$p.val %>% round(4)
  p_vals[[var_]]['2y vs 5y'] <- t.test(val_5y, val_2y)$p.val %>% round(4)
  p_vals[[var_]]['6w vs 5y'] <- t.test(val_5y, val_6w)$p.val %>% round(4)
  for(treatment_pos in 1:treatment_n){
    val_ <- data_treats[[treatment_pos]][[var_]]
    val_6w <- data_treats[[treatment_pos]][[var_6w]]
    val_2y <- data_treats[[treatment_pos]][[var_2y]]
    val_5y <- data_treats[[treatment_pos]][[var_5y]]
    
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]] <- list()
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 6w-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_6w , val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6w vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_6w)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['2y vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_2y)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6w vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_6w)$p.val %>% round(4)
  }
}

results %>% flextable %>% autofit() %>% fit_to_width(7.5)
```
```{r}
rbindlist(p_vals, idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[1]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```
```{r}
rbindlist(p_vals_treats[[treatment_vals[2]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[3]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```


### Quality of Life
```{r echo=FALSE, comment="", include=TRUE}
results <- NULL
p_vals <- list()
p_vals_treats <- list()
for(treatment_pos in 1:treatment_n){
    p_vals_treats[[treatment_vals[treatment_pos]]] <- list()
}
for(var_ in analysis_vars$quality ){
  var_6m <- "6M. {var_}" %>% f
  var_1y <- "1Y. {var_}" %>% f
  var_2y <- "2Y. {var_}" %>% f
  var_5y <- "5Y. {var_}" %>% f
  vars_years <- c(var_, var_6m, var_1y, var_2y, var_5y)
  for(var_y in vars_years){
    result <- calc_table(data_, var_y, treatment_n, data_treats, treatment_vals, treatment_)
    if(is.null(results)){
      results <- result
    }else{
      results <- rbind(results, result)
    }
  }
  
  p_vals[[var_]] <- list()
  val_ <- data_[[var_]]
  val_6m <- data_[[var_6m]]
  val_2y <- data_[[var_2y]]
  val_5y <- data_[[var_5y]]
  p_vals[[var_]]['Preop vs 6m'] <- t.test(val_6m , val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 2y'] <- t.test(val_2y, val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 5y'] <- t.test(val_5y, val_)$p.val %>% round(4)
  p_vals[[var_]]['6m vs 2y'] <- t.test(val_2y, val_6m)$p.val %>% round(4)
  p_vals[[var_]]['2y vs 5y'] <- t.test(val_5y, val_2y)$p.val %>% round(4)
  p_vals[[var_]]['6m vs 5y'] <- t.test(val_5y, val_6m)$p.val %>% round(4)
  for(treatment_pos in 1:treatment_n){
    val_ <- data_treats[[treatment_pos]][[var_]]
    val_6m <- data_treats[[treatment_pos]][[var_6m]]
    val_2y <- data_treats[[treatment_pos]][[var_2y]]
    val_5y <- data_treats[[treatment_pos]][[var_5y]]
    
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]] <- list()
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 6m-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_6m , val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6m vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_6m)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['2y vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_2y)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6m vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_6m)$p.val %>% round(4)
  }
}

results %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals, idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[1]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[2]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[3]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```



### Change Quality of Life
```{r echo=FALSE, comment="", include=TRUE}
data_change <- data_ %>% copy
p_vals <- list()
p_vals_treats <- list()
for(treatment_pos in 1:treatment_n){
    p_vals_treats[[treatment_vals[treatment_pos]]] <- list()
}
for(var_ in analysis_vars$quality ){
  var_6m <- "6M. {var_}" %>% f
  var_1y <- "1Y. {var_}" %>% f
  var_2y <- "2Y. {var_}" %>% f
  var_5y <- "5Y. {var_}" %>% f
  vars_years <- c(var_6m, var_1y, var_2y, var_5y)
  for(var_y in vars_years){
    data_change[, c(var_y) := get(var_y) - get(var_)]
  }
  data_treats_change <- list()
  for(treatment_pos in 1:treatment_n){
    data_treats_change[[treatment_pos]] <- data_change[get(treatment_) == treatment_vals[treatment_pos]]
  }
  
  for(var_y in vars_years){
    result <- calc_table(data_change, var_y, treatment_n, data_treats_change, treatment_vals, treatment_)
    if(is.null(results)){
      results <- result
    }else{
      results <- rbind(results, result)
    }
  }
  
  p_vals[[var_]] <- list()
  val_ <- data_change[[var_]]
  val_6m <- data_change[[var_6m]]
  val_2y <- data_change[[var_2y]]
  val_5y <- data_change[[var_5y]]
  p_vals[[var_]]['Preop vs 6m'] <- t.test(val_6m , val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 2y'] <- t.test(val_2y, val_)$p.val %>% round(4)
  p_vals[[var_]]['Preop vs 5y'] <- t.test(val_5y, val_)$p.val %>% round(4)
  p_vals[[var_]]['6m vs 2y'] <- t.test(val_2y, val_6m)$p.val %>% round(4)
  p_vals[[var_]]['2y vs 5y'] <- t.test(val_5y, val_2y)$p.val %>% round(4)
  p_vals[[var_]]['6m vs 5y'] <- t.test(val_5y, val_6m)$p.val %>% round(4)
  for(treatment_pos in 1:treatment_n){
    val_ <- data_treats_change[[treatment_pos]][[var_]]
    val_6m <- data_treats_change[[treatment_pos]][[var_6m]]
    val_2y <- data_treats_change[[treatment_pos]][[var_2y]]
    val_5y <- data_treats_change[[treatment_pos]][[var_5y]]
    
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]] <- list()
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 6m-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_6m , val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['Preop vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6m vs 2y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_2y, val_6m)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['2y vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_2y)$p.val %>% round(4)
    p_vals_treats[[treatment_vals[treatment_pos]]][[var_]]['6m vs 5y-{treatment_vals[treatment_pos]}' %>% f] <- t.test(val_5y, val_6m)$p.val %>% round(4)
  }
}

results %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals, idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[1]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```
```{r}
rbindlist(p_vals_treats[[treatment_vals[2]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r}
rbindlist(p_vals_treats[[treatment_vals[3]]], idcol="ID") %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

### Surgery
```{r echo=FALSE, comment="", include=TRUE}
for(var_ in analysis_vars$surgery ){
  result <- calc_table(data_, var_, treatment_n, data_treats, treatment_vals, treatment_)
  if(is.null(results)){
    results <- result
  }else{
    results <- rbind(results, result)
  }
}

results %>% flextable %>% autofit() %>% fit_to_width(7.5)
```



# Before 2Y

## Reinterventions

```{r}
res <- calc_complications_many(data_, treatment_vals, treatment_, lower_years=0, upper_years=2)
```

```{r, comment="", include=TRUE}
res$number_reiqs %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r, comment="", include=TRUE}
res$p_vals_reiqs %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Impacts

```{r, comment="", include=TRUE}
res$impacts %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories

```{r, comment="", include=TRUE}
res$categories %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories Major Complications

```{r include=TRUE}
res$categories_major %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Time to surgery

```{r include=TRUE}
res$time_to_surgery$stats %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r include=TRUE}
res$time_to_surgery$p_vals
```


# From 2Y - 5Y

## Reinterventions

```{r}
data_5 <- data_[followup_5y ==TRUE]
res <- calc_complications_many(data_5, treatment_vals, treatment_, lower_years=2, upper_years=5)
```

```{r include=TRUE}
res$number_reiqs %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r include=TRUE}
res$p_vals_reiqs 
```

## Impacts

```{r include=TRUE}
res$impacts %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories

```{r include=TRUE}
res$categories %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories Major Complications

```{r include=TRUE}
res$categories_major %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Time to surgery

```{r include=TRUE}
res$time_to_surgery$stats %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r include=TRUE}
res$time_to_surgery$p_vals 
```


# Before 5Y

## Reinterventions

```{r}
res <- calc_complications_many(data_5, treatment_vals, treatment_, lower_years=0, upper_years=5)
```

```{r include=TRUE}
res$number_reiqs %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r include=TRUE}
res$p_vals_reiqs 
``` 

## Impacts

```{r include=TRUE}
res$impacts %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories

```{r include=TRUE}
res$categories %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Categories Major Complications

```{r include=TRUE}
res$categories_major %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

## Time to surgery

```{r include=TRUE}
res$time_to_surgery$stats %>% flextable %>% autofit() %>% fit_to_width(7.5)
```

```{r include=TRUE}
res$time_to_surgery$p_vals 
```
